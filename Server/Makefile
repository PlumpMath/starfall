## Copyright (c) 2013 Mark Farrell -- This source code is released under the MIT license (http://opensource.org/licenses/MIT).

STARFALL_DEPENDENCIES = $(HOME)/Development

POCO_DIR=poco-1.4.6p1-all

STARFALL_INCLUDES := -I $(STARFALL_DEPENDENCIES)/$(POCO_DIR)/Foundation/include
STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I  $(STARFALL_DEPENDENCIES)/$(POCO_DIR)/Net/include
STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I  $(STARFALL_DEPENDENCIES)/$(POCO_DIR)/Util/include 
STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I  $(STARFALL_DEPENDENCIES)/$(POCO_DIR)/XML/include
STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I  $(STARFALL_DEPENDENCIES)/$(POCO_DIR)/Data/include
STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I  $(STARFALL_DEPENDENCIES)/$(POCO_DIR)/Data/SQLite/include
STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I  $(STARFALL_DEPENDENCIES)/v8/include
STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I  $(STARFALL_DEPENDENCIES)/glm

STARFALL_INCLUDES := $(STARFALL_INCLUDES) -I ../Common/Include

STARFALL_INCLUDES := $(STARFALL_INCLUDES)  -I Include

STARFALL_LIBRARIES := -L$(STARFALL_DEPENDENCIES)/$(POCO_DIR)/lib/Darwin/x86_64/ -L$(STARFALL_DEPENDENCIES)/v8/out/x64.release -L../Common/lib

STARFALL_LINK := -lPocoFoundation -lPocoNet -lPocoUtil -lPocoData -lPocoDataSQLite -lv8_base -lv8_nosnapshot -lcommon

STARFALL_SERVER_SRC = Source/Starfall
STARFALL_SERVER_SRCS := $(wildcard $(STARFALL_SERVER_SRC)/*.cpp)

STARFALL_SERVER_OBJ := obj
STARFALL_SERVER_OBJS := $(patsubst $(STARFALL_SERVER_SRC)/%.cpp, $(STARFALL_SERVER_OBJ)/%.o, $(STARFALL_SERVER_SRCS))

STARFALL_SERVER_BIN := bin
STARFALL_SERVER_RELEASE := server.release

.DEFAULT_GOAL := release

$(STARFALL_SERVER_BIN):
	mkdir -p $(STARFALL_SERVER_BIN)

$(STARFALL_SERVER_OBJ):
	mkdir -p $(STARFALL_SERVER_OBJ)

$(STARFALL_SERVER_OBJ)/%.o: $(STARFALL_SERVER_SRC)/%.cpp $(STARFALL_SERVER_OBJ)
	$(CXX)  -c -o $@ $< $(STARFALL_INCLUDES) -Wno-deprecated-declarations

release: $(STARFALL_SERVER_OBJS) $(STARFALL_SERVER_BIN)
	$(CXX) $(STARFALL_SERVER_OBJS) -o $(STARFALL_SERVER_BIN)/$(STARFALL_SERVER_RELEASE) $(STARFALL_LIBRARIES)  $(STARFALL_LINK)

.PHONY: clean

clean:
	rm -f $(STARFALL_SERVER_OBJ)/*.o
	rm -d $(STARFALL_SERVER_OBJ)
	rm -f $(STARFALL_SERVER_BIN)/*
	rm -d $(STARFALL_SERVER_BIN)
